syntax = "proto3";
package veter.relay.v1;

message Ciphertext {
  bytes id = 1;
  bytes sender_device_id = 2;
  bytes room_id = 3;
  bytes payload = 4; // E2EE blob
  int64 sent_ts = 5;
}

message EnqueueRequest { repeated Ciphertext messages = 1; }
message EnqueueResponse { repeated bytes accepted_ids = 1; }

message DequeueRequest { bytes device_id = 1; uint32 max_items = 2; uint32 credits = 3; }
message DequeueResponse { repeated Ciphertext messages = 1; }

message AckRequest { repeated bytes ids = 1; }
message AckResponse {}

service Relay {
  rpc Enqueue(EnqueueRequest) returns (EnqueueResponse);
  rpc Dequeue(DequeueRequest) returns (DequeueResponse);
  rpc Ack(AckRequest) returns (AckResponse);
}
